# ====== Categoría ======
Categoria:
  type: object
  required: [id, nombre]
  properties:
    id: { type: integer, example: 3 }
    nombre: { type: string, example: "Electrodomésticos" }
    descripcion: { type: string, nullable: true, example: "Línea blanca y cocina" }

CategoriaCreate:
  type: object
  required: [nombre]
  properties:
    nombre: { type: string, example: "Electrodomésticos" }
    descripcion: { type: string, nullable: true }

CategoriaUpdate:
  type: object
  properties:
    nombre: { type: string }
    descripcion: { type: string, nullable: true }

# ====== Producto ======
Producto:
  type: object
  required: [id, nombre, precio, stock]
  properties:
    id: { type: integer, example: 101 }
    nombre: { type: string, example: "Refrigerador X" }
    descripcion: { type: string, nullable: true }
    precio: { type: number, format: float, example: 499.99 }
    stock: { type: integer, example: 12 }
    low_stock_threshold: { type: integer, example: 3 }
    categoria:
      allOf:
        - $ref: '#/components/schemas/Categoria'
      nullable: true
    categoria_id:
      type: integer
      nullable: true
      description: ID de categoría (writeOnly en la API real)
      example: 1
    imagen:
      type: string
      nullable: true
      description: URL pública de la imagen (subida a S3 en el backend)
      example: "https://bucket.s3.amazonaws.com/productos/abc.png"
    active_discount:
      allOf:
        - $ref: '#/components/schemas/ProductoDescuentoLite'
      nullable: true
      readOnly: true

ProductoCreateUpdate:
  type: object
  properties:
    nombre: { type: string }
    descripcion: { type: string, nullable: true }
    precio: { type: number, format: float }
    stock: { type: integer }
    low_stock_threshold: { type: integer, default: 0 }
    categoria_id: { type: integer, nullable: true }
    imagen:
      type: string
      nullable: true
      description: URL (si no se envía `imagen_archivo`)
  required: [nombre, precio, stock]

# ====== Descuentos ======
ProductoDescuentoLite:
  type: object
  required: [id, porcentaje, fecha_inicio]
  properties:
    id: { type: integer, example: 7 }
    porcentaje: { type: number, format: float, example: 15 }
    fecha_inicio: { type: string, format: date-time }
    fecha_fin: { type: string, format: date-time, nullable: true }
    precio_original: { type: number, format: float, example: 499.99 }
    precio_con_descuento: { type: number, format: float, example: 424.99 }
    esta_activo: { type: boolean, example: true }

ProductoDescuento:
  allOf:
    - $ref: '#/components/schemas/ProductoDescuentoLite'
    - type: object
      properties:
        producto:
          $ref: '#/components/schemas/Producto'
        producto_id:
          type: integer
          writeOnly: true
          example: 101

ProductoDescuentoBase:
  type: object
  properties:
    porcentaje: { type: number, format: float, minimum: 0.01, maximum: 99.99 }
    fecha_inicio: { type: string, format: date-time }
    fecha_fin: { type: string, format: date-time, nullable: true }

ProductoDescuentoCreate:
  allOf:
    - $ref: '#/components/schemas/ProductoDescuentoBase'
    - type: object
      required: [producto_id, porcentaje, fecha_inicio]
      properties:
        producto_id: { type: integer }

ProductoDescuentoUpdate:
  allOf:
    - $ref: '#/components/schemas/ProductoDescuentoBase'

# ====== Carrito ======
Carrito:
  type: object
  description: Carrito del usuario autenticado
  required: [id, total, estado, actualizado_en, expires_at, detalles]
  properties:
    id: { type: integer, example: 230 }
    total: { type: number, format: float, example: 109.97 }
    estado: { type: string, example: "pendiente" }
    actualizado_en: { type: string, format: date-time }
    expires_at: { type: string, format: date-time, description: "actualizado_en + 1 hora" }
    detalles:
      type: array
      items: { $ref: '#/components/schemas/CarritoDetalle' }

CarritoDetalle:
  type: object
  required: [id, producto, cantidad, subtotal]
  properties:
    id: { type: integer, example: 999 }
    producto: { $ref: '#/components/schemas/Producto' }
    producto_id:
      type: integer
      writeOnly: true
      example: 101
    cantidad: { type: integer, example: 2 }
    subtotal: { type: number, format: float, example: 219.98 }

CarritoDetalleCreate:
  type: object
  required: [producto_id, cantidad, subtotal]
  properties:
    producto_id: { type: integer, example: 101 }
    cantidad: { type: integer, example: 2 }
    subtotal: { type: number, format: float, example: 219.98 }

CarritoDetalleUpdate:
  type: object
  properties:
    producto_id: { type: integer }
    cantidad: { type: integer }
    subtotal: { type: number, format: float }

CartItemInput:
  type: object
  required: [product_id, quantity]
  properties:
    product_id: { type: integer, example: 101 }
    quantity: { type: integer, minimum: 1, example: 2 }
